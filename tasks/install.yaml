- name: Import distro specific variables
  include_vars: "{{ lookup('first_found', params) }}"
  vars:
    params:
      files:
        - '{{ ansible_distribution }}.yml'
        - '{{ ansible_os_family }}.yml'
        - main.yml
      paths:
        - 'vars'

- name: Install dehydrated
  package:
    name: "{{ dehydrated_dependencies }}"


- name: Install dehydrated systemd units
  vars:
    dest: "/etc/systemd/system/{{ item }}"
  loop:
    - dehydrated.service
    - dehydrated.timer
  template:
    src: "systemd/{{ item }}"
    dest: "{{ dest }}"

- name: Enable and start dehydrated systemd timer
  loop:
    - dehydrated.timer
  systemd:
    daemon_reload: yes
    name: "{{ item }}"
    enabled: yes
    state: started
